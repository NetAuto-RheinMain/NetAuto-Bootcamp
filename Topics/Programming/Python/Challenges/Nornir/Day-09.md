# **Day 9: Integrating Nornir with Containerlab's Generated Inventory**

## **Objective:** 
Leverage Containerlab's ability to generate Nornir-compatible inventory files.

## **Concepts:**

* Containerlab's `containerlab deploy --export-inventory` feature.
* Understanding the structure of the generated inventory.
* Dynamic inventory loading.

## **Challenge:** 
Redeploy your two-cEOS lab and automatically use the inventory generated by Containerlab for a Nornir task.

## **Code Examples:**

1.  **`clab_2_ceos_topology.yaml` (from Day 2).**

```yaml
name: two-ceos-lab
topology:
    nodes:
        ceos1:
            kind: arista_ceos
            image: ceos:4.28.0F
        ceos2:
            kind: arista_ceos
            image: ceos:4.28.0F
```

2.  **Deploy lab and export inventory:**

```bash
sudo containerlab deploy --topo clab_2_ceos_topology.yaml --export-inventory
```

This will create a `nornir.yaml` (or similar) file in your current directory. Inspect this file to see how Containerlab maps its nodes to Nornir hosts. You might need to adjust the `username` and `password` or add `connection_options` for `scrapli` if they are not included by default.

3.  **`nornir_config_clab.yaml` (adjust to point to exported inventory):**

```yaml
---
inventory:
    plugin: SimpleInventory
    options:
    host_file: "nornir.yaml" # or whatever containerlab named it
    # You might not need group_file and defaults_file if all info is in nornir.yaml
    # Otherwise, point to existing ones or create new ones if needed.
runner:
    plugin: threaded
    options:
    num_workers: 2
```

*Note: Containerlab's exported inventory might have a different structure or naming convention. You may need to adapt `nornir_config_clab.yaml` and your Nornir tasks accordingly.*

4.  **`day9_clab_inventory.py`:**

```python
from nornir import InitNornir
from nornir_scrapli.tasks import send_command
from nornir.core.filter import F

def get_hostname(task):
    result = task.run(task=send_command, command="show hostname")
    print(f"\nHost: {task.host.name}, Remote Hostname: {result.result.strip()}")

def main():
    # Initialize Nornir using the inventory exported by Containerlab
    nr = InitNornir(config_file="nornir_config_clab.yaml")
    nr.run(task=get_hostname)

if __name__ == "__main__":
    main()
```

Run: `python day9_clab_inventory.py`

